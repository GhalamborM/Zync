# دست از مدیریت دستی اسکریپت‌های SQL بردارید: معرفی Zync، مدیر بسته پایگاه داده

[![Test Coverage](https://img.shields.io/badge/Tests-100%25%20Pass-brightgreen.svg)](../Test/)
[![Objects](https://img.shields.io/badge/Objects-131-blue.svg)](../Packages/)
[![Packages](https://img.shields.io/badge/Packages-12-orange.svg)](../Packages/)

اگر تا به حال روی یک پروژه بزرگ پایگاه داده کار کرده باشید، با این دردسر آشنا هستید. پوشه‌هایی پر از اسکریپت‌های SQL برای رویه‌ها (stored procedures)، توابع و نماها (views) دارید. اسکریپت `A` به `B` وابسته است و `B` به `C`. استقرار در یک محیط جدید به معنای اجرای آن‌ها به ترتیب صحیح است و وای به روزی که یکی را از قلم بیندازید. اشتراک‌گذاری ابزارهای قابل استفاده مجدد بین پروژه‌ها یک کابوس کپی-پیست است.

**Zync نسخه 3.0** با 12 پکیج آماده، 131 آبجکت تست‌شده و پوشش تست 100% این مشکلات را حل می‌کند.

ما مدیران بسته قدرتمندی برای کدهای برنامه‌های خود ساخته‌ایم—npm برای Node.js، NuGet برای .NET، Pip برای پایتون. آن‌ها وابستگی‌ها، نسخه‌بندی و توزیع را بی‌نقص مدیریت می‌کنند. پس چرا ما هنوز اسکریپت‌های پایگاه داده را طوری مدیریت می‌کنیم که انگار در سال ۱۹۹۹ هستیم؟

وقت تغییر فرا رسیده است. معرفی **Zync**، یک مدیر بسته ساده اما قدرتمند برای SQL Server که برای آوردن راحتی مدیریت بسته‌های مدرن مستقیماً به پایگاه داده شما طراحی شده است.

### هرج و مرج مدیریت دستی اسکریپت

قبل از اینکه به راه‌حل بپردازیم، بیایید مشکل را درک کنیم. به طور سنتی، مدیریت مجموعه‌ای از اشیاء پایگاه داده شامل موارد زیر است:

*   **ردیابی دستی وابستگی‌ها:** شما باید به خاطر داشته باشید که `CreateUserView.sql` باید بعد از `CreateUserTable.sql` اجرا شود. این دانش اغلب در ذهن یک توسعه‌دهنده یا یک فایل `README` شکننده ذخیره می‌شود.
*   **اسکریپت‌های پراکنده:** توابع و رویه‌های کاربردی اغلب در پوشه‌های مختلف پروژه پراکنده هستند که منجر به تکرار کد و سردردهای نگهداری می‌شود.
*   **استقرار ناسازگار:** استقرار در یک پایگاه داده جدید اغلب یک فرآیند دستی و مستعد خطا است که به راحتی می‌تواند منجر به ناهماهنگی بین محیط‌های توسعه، تست و تولید شود.
*   **همکاری دشوار:** به اشتراک گذاشتن مجموعه‌ای از ابزارهای مفید پایگاه داده با تیم یا جامعه به هیچ وجه ساده نیست.

Zync از دل این ناامیدی متولد شد. این پروژه با اشیاء پایگاه داده شما مانند **بسته‌ها** رفتار می‌کند—واحدهای کد ماژولار، قابل استفاده مجدد و آگاه از وابستگی.

### چگونه Zync گردش کار شما را ساده می‌کند

Zync بر پایه یک رویه ذخیره شده واحد، `dbo.Zync`، ساخته شده است که به عنوان رابط خط فرمان شما در داخل SQL Server Management Studio (SSMS) عمل می‌کند. پس از نصب، از طریق دستورات ساده به دنیایی از قابلیت‌ها دسترسی پیدا می‌کنید.

فلسفه اصلی ساده است: بسته‌های SQL خود را در یک مخزن گیت‌هاب میزبانی کنید و اجازه دهید Zync بقیه کارها را انجام دهد.

#### مفاهیم کلیدی:

*   **📦 مدیریت بسته:** اشیاء SQL مرتبط (رویه‌ها، توابع و غیره) را در یک "بسته" گروه‌بندی کنید، که به سادگی یک پوشه در یک مخزن است.
*   **🔄 حل خودکار وابستگی‌ها:** وابستگی‌ها را برای یک بسته تعریف کنید و Zync به طور خودکار ابتدا آن‌ها را دریافت و نصب می‌کند.
*   **🎯 دستورات ساده:** یک ساختار دستوری تمیز و شهودی برای لیست کردن و نصب بسته‌ها.
*   **🏗️ مخازن استاندارد:** از مخزن رسمی Zync استفاده کنید یا آن را برای بسته‌های خصوصی به مخزن خودتان متصل کنید.

### شروع کار با Zync

در حال حاضر Zync مخصوص SQL Server (MsSql) است. تمام اسکریپت‌ها، پکیج‌ها، تست‌ها و ابزارها زیر پوشه‌ی `MsSql/` قرار دارند.

آماده‌اید امتحان کنید؟ فقط چند دقیقه طول می‌کشد تا راه‌اندازی شود.

#### مرحله ۱: نصب رویه ذخیره شده Zync

ابتدا، باید رویه اصلی `Zync` را در پایگاه داده هدف خود نصب کنید. فقط اسکریپت [`Zync.sql`](https://github.com/mirshahreza/Zync/blob/main/MsSql/Zync.sql) را از مخزن رسمی دانلود و اجرا کنید. این راه‌اندازی یک‌باره تمام چیزی است که نیاز دارید.

#### مرحله ۲: لیست کردن بسته‌های موجود

پس از نصب، می‌توانید با دستور `ls` (list) ببینید کدام بسته‌ها در مخزن پیش‌فرض موجود هستند. خروجی ریشه بر اساس فایل شاخص مخزن در مسیر `MsSql/Packages/.sql` بسته‌ها و اسکریپت‌های داخل هر بسته را (فقط نام‌ها) نمایش می‌دهد.

```sql
EXEC [dbo].[Zync] 'ls'
```

این دستور فایل شاخص را می‌خواند و فهرستی از بسته‌ها و اسکریپت‌های داخلی آن‌ها (بدون توضیح) برای مرور سریع نشان می‌دهد.
```
Listing package(s): ''...

 -> Expanding packages and listing contained objects:
	[DateTime]:
		- ZzStartOfWeek.sql
		- ZzEndOfWeek.sql
		- ...
	[DbMan]:
		- ZzCreateTableGuid.sql
		- ZzCreateOrAlterFk.sql
		- ...
	[DbMon]:
		- ZzSelectActiveSessions.sql
		- ZzSelectBackupHistory.sql
		- ...
	[Math]:
		- ZzFormatBytes.sql
		- ZzSafeDivide.sql
		- ...
	[String]:
		- ZzSplitString.sql
		- ZzCountWord.sql
		- ...
	[Financial]:
		- ZzCalculateLoanPayment.sql
		- ...
```

#### جستجو و کشف

می‌توانید در همه پکیج‌ها یا داخل یک پکیج خاص جستجو کنید:

```sql
-- جستجو در همه‌جا (حساس به حروف نیست؛ % یا * به‌عنوان wildcard)
EXEC [dbo].[Zync] 'ls ?week';

-- جستجو داخل یک پکیج بر اساس نام یا توضیح
EXEC [dbo].[Zync] 'ls DbMon ?agent%status';
```

#### مرحله ۳: نصب اولین بسته شما

فرض کنید به مجموعه‌ای از ابزارهای دستکاری رشته نیاز دارید. می‌توانید بسته `String` را با دستور `i` (install) نصب کنید.

```sql
EXEC [dbo].[Zync] 'i String'
```

این چیزی است که در پشت صحنه اتفاق می‌افتد:
۱. Zync URL فایل اصلی SQL بسته را در مخزن می‌سازد.
۲. محتوای اسکریپت را دریافت می‌کند.
۳. هرگونه وابستگی لیست شده در بالای فایل را بررسی کرده و ابتدا آن‌ها را نصب می‌کند.
۴. در نهایت، اسکریپت را اجرا می‌کند و تمام اشیاء بسته `String` را در پایگاه داده شما ایجاد می‌کند.

**خروجی:**

```
Installing package: 'String'...
 -> Fetched 'String' successfully.
 -> Package 'String' installed successfully.
```

به همین سادگی، اکنون به توابع مفیدی مانند `ZzSplitString` و `ZzCountWord` دسترسی دارید بدون اینکه هرگز ویرایشگر کوئری خود را ترک کنید.

همچنین می‌توانید یک اسکریپت واحد از یک بسته را نصب کنید اگر به کل مجموعه نیاز ندارید:

```sql
-- فقط تابع ZzSplitString را نصب می‌کند
EXEC [dbo].[Zync] 'i String/ZzSplitString.sql'
```

### نگاهی به اکوسیستم Zync

مخزن پیش‌فرض در حال حاضر شامل چندین بسته مفید برای شروع کار شما است:

*   **DbMan, DbMon:** مجموعه‌ای قدرتمند از ابزارها برای مدیریت پایگاه داده، شامل ایجاد/حذف جدول و ستون، تحلیل وابستگی‌ها و ابزارهای اکتشاف شِما (Schema Exploration).
*   **String:** مجموعه‌ای از توابع برای عملیات رایج رشته مانند تقسیم کردن، پاک‌سازی فاصله‌ها و شمارش.
*   **Math:** توابع کمکی برای قالب‌بندی اعداد و تبدیل اندازه‌های بایت (مثلاً به KB، MB، GB).

### وضعیت فعلی پروژه

**Zync نسخه 3.0** در حال حاضر کاملاً آماده استفاده در محیط تولید است:

*   ✅ **12 پکیج آماده** با 131 آبجکت تست‌شده
*   ✅ **پوشش تست 100%** - تمام تست‌ها با موفقیت گذشته‌اند
*   ✅ **اسکریپت‌های خودکارسازی PowerShell** برای نصب و تست
*   ✅ **مستندات کامل** برای تمام پکیج‌ها

**پکیج‌های موجود:**
- **Backup** (4): ابزارهای پشتیبان‌گیری و بازیابی
- **Base** (8): جداول پایه برای نیازهای عمومی
- **DateTime** (32): توابع جامع تاریخ و زمان
- **DbMan** (23): ابزارهای مدیریت دیتابیس
- **DbMon** (35): ابزارهای نظارت و تشخیص
- **Financial** (9): محاسبات مالی
- **Geographic** (26): محاسبات جغرافیایی
- **Json** (5): دستکاری JSON
- **Math** (35): توابع ریاضی
- **Security** (5): ابزارهای امنیتی و رمزنگاری
- **String** (43): عملیات رشته‌ای
- **Validation** (5): توابع اعتبارسنجی

### نقشه راه آینده

*   **پشتیبانی از پایگاه‌های داده دیگر** مانند PostgreSQL، MySQL و Oracle
*   **نسخه‌بندی پیشرفته** برای مدیریت نسخه‌های مختلف بسته‌ها
*   **مصورسازی وابستگی‌ها** برای درک بهتر روابط بین پکیج‌ها
*   **مرورگر وب** برای جستجو و کشف پکیج‌ها

### به این جنبش بپیوندید

مدیریت کد پایگاه داده نباید یک کار طاقت‌فرسا باشد. Zync یک رویکرد مدرن و ساده ارائه می‌دهد که در زمان صرفه‌جویی کرده و خطاها را کاهش می‌دهد. این پروژه به توسعه‌دهندگان قدرت می‌دهد تا ابزارهای پایگاه داده را به راحتی بسازند، به اشتراک بگذارند و دوباره استفاده کنند.

پروژه را در گیت‌هاب بررسی کنید، به آن ستاره بدهید و آن را در پروژه‌های خود امتحان کنید. مشارکت‌ها، بازخوردها و ایده‌ها همیشه مورد استقبال قرار می‌گیرند.

**پروژه را اینجا پیدا کنید: [https://github.com/mirshahreza/Zync](https://github.com/mirshahreza/Zync)**

نکته: Zync به‌صورت پیش‌فرض از آدرس `https://raw.githubusercontent.com/mirshahreza/Zync/master/MsSql/Packages/` دریافت می‌کند. برای ریپوی شخصی/شاخه‌ی متفاوت، همان URL را به عنوان پارامتر دوم بدهید؛ مثال: `EXEC dbo.Zync 'i String', 'https://raw.githubusercontent.com/<user>/<repo>/main/MsSql/Packages/';`.

دستورات مفید فراتر از نصب/لیست:
- `lo` یا `list-objects`: نمایش همه‌ی آبجکت‌هایی که با Zz شروع می‌شوند
- `clean`: حذف تمام آبجکت‌های مدیریت‌شده توسط Zync و داده‌های رهگیری
- `rm <pkgOrFile>`: حذف یک پکیج یا فایل خاص (در صورت موجود بودن، نسخه‌ی قبلی را برمی‌گرداند)
- `rb <package>`: بازگردانی پکیج به نسخه‌ی قبلی

---

### تست‌های خودکار و جامع

Zync یک مجموعه تست کامل با پوشش 100% برای اطمینان از کیفیت و پایداری دارد:

```powershell
# تست اتصال به دیتابیس
.\scripts\TestConnection.ps1

# نصب تمام پکیج‌ها از فایل‌های محلی
.\scripts\InstallLocalPackages.ps1

# اجرای تمام تست‌ها (توصیه می‌شود)
.\scripts\RunAllTests.ps1

# اجرای تست یک پکیج خاص
.\scripts\RunSingleTest.ps1 -TestName string
.\scripts\RunSingleTest.ps1 -TestName math

# لیست تست‌های موجود
.\scripts\ListTests.ps1

# اعتبارسنجی ساختار فایل‌های تست
.\scripts\ValidateTests.ps1
```

**نتایج آخرین تست:**
- ✅ 11 فایل تست
- ✅ 131 آبجکت تست‌شده
- ✅ 100% نرخ موفقیت
- ⚡ میانگین زمان اجرا: 60ms هر تست

تمام لاگ‌های تست در `MsSql/TestLogs/` ذخیره می‌شوند.

---

**محسن میرشاهرضا**  
توسعه‌دهنده و معمار پایگاه داده  
GitHub: [@mirshahreza](https://github.com/mirshahreza)
